---
title: Predator–Prey Neural Net Simulation
summary: Real‑time ecosystem with optional neural‑network‑driven agents, genetics, terrain, weather, and two renderers (OpenGL/Pygame).
tags: [Simulation, AI, Neural Networks, Evolution, Python, Pygame, OpenGL]
status: Active
date: 2025-09-29
cover_image: /project-corpus/placeholder.svg
alt: Predator–prey ecosystem simulation (placeholder cover)
permalink: /project-corpus/projects/predprey-neuralnet/
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title }} — Project</title>
    <meta name="description" content="{{ page.summary }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/project-corpus/assets-styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="/project-corpus/" style="text-decoration:none;color:var(--muted)">← Back to all projects</a>
        <h1 class="project-title">{{ page.title }}</h1>
        <p class="project-subtitle">{{ page.summary }}</p>
      </div>
    </header>
    <main class="container project-main">
      <section class="project-content">
        <div class="hero">
          <img src="{{ page.cover_image }}" alt="{{ page.alt }}" />
        </div>

        <h2>Problem</h2>
        <p>
          Build a compact, testable predator–prey ecosystem that’s fun to watch
          in real time, but also rigorous enough to run headless under tests.
          The world should be dynamic (plants, weather, day/night), support
          genetics and simple neural brains for behavior, and remain performant
          as populations grow.
        </p>

        <h2>Approach</h2>
        <p>
          The simulation centers on a small set of entities—prey, predators,
          scavengers, plants, and corpses—updated by a single <code>World</code>
          object each frame. A swappable spatial index (uniform grid by default,
          quadtree available) accelerates neighbor queries. Behavior is expressed
          either via tuned steering weights or an optional feed‑forward neural
          network whose weights live in the genome. Rendering is pluggable:
          a ModernGL/OpenGL path for GPU‑accelerated visuals, and a Pygame path
          for a pure‑CPU surface renderer. A headless mode runs the test suite
          for CI and non‑GUI environments.
        </p>

        <h3>Architecture</h3>
        <ul>
          <li>Core loop — <code>ecosim.core.world.World</code> steps entities, spawns offspring, updates plants/corpses, rebuilds the spatial index, and records population metrics.</li>
          <li>Entities — <code>Prey</code>, <code>Predator</code>, <code>Scavenger</code>, <code>Plant</code>, <code>Corpse</code>. Moving agents inherit steering and energy mechanics from a shared base.</li>
          <li>Behavior — Optional neural nets (<code>ecosim.genetics.neural_net</code>) compute steering weights from inputs (e.g., hunger, light, distances). Fallback weights come from the genome for deterministic behavior without NN.</li>
          <li>Genetics — <code>Genome</code>/<code>GenomeSchema</code> define traits and optional brain weights; crossover and mutation support simple inheritance. The prey <code>perception</code> gene is used as a behavioral weight only; the actual visual radius is reset to a constant at init.</li>
          <li>Environment — Day/night cycle emits hourly events; weather follows a Markov chain with states (sunny, rain, drought, cold snap); terrain is procedurally generated and classifies tiles into plains, forest, rock, water.</li>
          <li>Spatial index — Default <code>UniformGridIndex</code> with incremental updates and auto cell sizing; <code>QuadtreeIndex</code> is available for comparison. Entities use an LRU cache keyed by index iteration to amortize neighbor lookups.</li>
          <li>Rendering — Two backends: <code>opengl</code> (ModernGL + GPU batches, HUD with SDF text) and <code>pygame</code> (software rendering). Both show the terrain overlay, grid, brain vectors, and population HUD.</li>
          <li>Clustering — Species IDs assigned from lineage clustering; a fast NumPy‑based linkage path runs asynchronously when available, with graceful fallback.</li>
        </ul>

        <h3>Stack</h3>
        <ul>
          <li>Python — Core simulation and CLI.</li>
          <li>Pygame — CPU renderer and input handling.</li>
          <li>ModernGL + PyOpenGL — GPU rendering path with batched geometry.</li>
          <li>NumPy (optional) — Accelerated species clustering.</li>
          <li>pytest — Test suite and benchmarks.</li>
          <li>pre‑commit, ruff, black, isort — Linting/formatting hooks.</li>
        </ul>

        <h3>Challenges</h3>
        <ul>
          <li>Neighbor queries at scale — Solved with a uniform grid spatial index, incremental updates, and an entity‑local LRU keyed by index iteration.</li>
          <li>Determinism vs. adaptability — Neural brains are optional; when disabled, legacy genome weights keep runs predictable for tests.</li>
          <li>Visual radius semantics — The prey <code>perception</code> gene is intentionally treated as a behavior weight, not a physical radius, and the radius is reset to the configured constant.</li>
          <li>Backend parity — Kept Pygame and OpenGL feature sets aligned (HUD, terrain overlays, debug vectors, hotkeys) while allowing GPU optimizations.</li>
          <li>Threading overhead — Benchmarks showed single‑worker scheduling slightly outperforms multi‑threading for this workload; default <code>THREAD_WORKERS=1</code>.</li>
        </ul>

        <h2>Outcomes</h2>
        <p>
          The simulation runs smoothly with hundreds of active entities and provides
          rich debugging overlays (population graph, grid, brain vectors, species tints).
          Headless mode routes directly to the test suite, enabling CI and reproducible
          profiling. Thread benchmarks (via <code>scripts/profile_threads.py</code>) recommend a single worker thread for the scheduler.
        </p>

        <h2>Usage</h2>
        <pre><code>python main.py                  # OpenGL by default
python main.py --renderer pygame
python main.py --headless           # run logic/tests without a display
python main.py --max-frames 600     # exit after N frames
python main.py --cell-size 128      # override auto cell size
        </code></pre>
        <p>Hotkeys (both backends): Esc quit; Space pause; F add food; P add prey; O add predator; S add scavenger at mouse; T toggle terrain overlay; G toggle grid; H help; N brain vector debug; +/- adjust simulation time scale.</p>

        <h3>Behavior inputs/outputs</h3>
        <ul>
          <li>Prey inputs — hunger, fear, light, food distance → outputs map to weights: seek food, flee, seek mate, avoid walls, wander.</li>
          <li>Predator inputs — hunger, prey distance, pack distance, light → outputs map to weights: hunt, seek mate, avoid walls, wander.</li>
        </ul>

        <section class="updates">
          <h2>Updates</h2>
          {% assign updates_base = page.url | append: 'updates/' %}
          {% assign updates = site.pages | where_exp: 'u', "u.url contains updates_base" | sort: 'date' | reverse %}
          {% if updates.size > 0 %}
            {% for u in updates limit: 5 %}
              <article class="update">
                <h3><a href="{{ u.url }}">{{ u.title }}</a></h3>
                {% if u.date %}<time datetime="{{ u.date | date_to_xmlschema }}">{{ u.date | date: '%b %d, %Y' }}</time>{% endif %}
                {% if u.excerpt %}<p>{{ u.excerpt }}</p>{% endif %}
              </article>
            {% endfor %}
          {% else %}
            <p>No updates yet.</p>
          {% endif %}
        </section>
      </section>
      <aside class="project-aside">
        <dl class="facts">
          <dt>Status</dt>
          <dd><span class="badge status {{ page.status | downcase }}">{{ page.status }}</span></dd>
          <dt>Tags</dt>
          <dd>{{ page.tags | join: ', ' }}</dd>
          <dt>Started</dt>
          <dd>{{ page.date | date: '%b %Y' }}</dd>
          <dt>Links</dt>
          <dd>
            <ul>
              <li><a href="#">Live demo</a></li>
              <li><a href="#">GitHub</a></li>
            </ul>
          </dd>
        </dl>
      </aside>
    </main>
    <footer class="site-footer">
      <div class="container">
        <small>© {{ "now" | date: "%Y" }} Adam Bandel</small>
      </div>
    </footer>
  </body>
  </html>

