---
title: Habit Ledger
summary: Fast, offline-first habit tracking with typed entries, widgets, reminders, and robust NDJSON backups.
tags: [Android, Kotlin, Jetpack Compose, Room, WorkManager, Glance, DataStore, Notifications, Widgets, Backup]
status: Active
date: 2025-09-29
cover_image: /project-corpus/placeholder.svg
alt: Placeholder cover illustrating Habit Ledger Android app
permalink: /project-corpus/projects/habit-ledger/
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title }} — Project</title>
    <meta name="description" content="{{ page.summary }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/project-corpus/assets-styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="/project-corpus/" style="text-decoration:none;color:var(--muted)">← Back to all projects</a>
        <h1 class="project-title">{{ page.title }}</h1>
        <p class="project-subtitle">{{ page.summary }}</p>
      </div>
    </header>
    <main class="container project-main">
      <section class="project-content">
        <div class="hero">
          <img src="{{ page.cover_image }}" alt="{{ page.alt }}" />
        </div>

        <h2>Problem</h2>
        <p>
          Most habit apps optimize for one interaction pattern (checklists, streaks, timers),
          but real-world tracking spans several shapes: quick “events”, numeric
          measurements, running counters, free-form notes, and single-choice states.
          Context switching across apps or flows adds friction, which leads to fewer logs
          and incomplete data. I wanted a single, fast ledger that captures anything,
          works offline, supports homescreen widgets, and mirrors data to portable files.
        </p>

        <h2>Approach</h2>
        <p>
          Habit Ledger is an offline-first Android app built with Jetpack Compose.
          Trackers are typed—<em>Quantity</em>, <em>Event</em>, <em>Note</em>, <em>Counter</em>, and <em>Choice</em>—so the
          UI and storage match how you actually log. A single Room schema stores
          everything as append-only entries. WorkManager handles background
          mirroring to an NDJSON log in a user-picked folder and can generate a full
          snapshot on demand. Glance powers lightweight widgets for one-tap capture,
          including split controls for counters. Optional reminders nudge logging
          without being noisy.
        </p>

        <h3>Architecture</h3>
        <ul>
          <li>Data model — Room entities: <code>Tracker</code>, <code>Entry</code>, <code>Tag</code>, <code>EntryTag</code>, <code>CounterState</code>.</li>
          <li>Repositories — <code>EntryRepository</code>, <code>TrackerRepository</code>, <code>MirrorRepository</code> isolate Room + IO.</li>
          <li>Background work — WorkManager workers: <code>MirrorAppendWorker</code>, <code>SnapshotWorker</code>, <code>ReminderWorker</code>.</li>
          <li>Widgets — Glance app widget with per-tracker config, custom colors, and counter split-tap controls.</li>
          <li>Preferences — DataStore persists widget links and backup folder (SAF tree URI).</li>
          <li>Export — One-click JSON export via <code>FileProvider</code> for easy sharing/import.</li>
          <li>Seeds — First launch seeds example trackers (Weight, Water, Calories, Journal).</li>
        </ul>

        <h3>Stack</h3>
        <ul>
          <li>Jetpack Compose + Material 3 — Modern, responsive UI and dialog sheets.</li>
          <li>Room (KTX + KSP) — Typed persistence with flows and efficient queries.</li>
          <li>Coroutines — Off-main-thread IO and structured concurrency.</li>
          <li>WorkManager — Reliable background tasks for mirroring and reminders.</li>
          <li>Glance — Lightweight, reactive homescreen widgets.</li>
          <li>DataStore — Simple, robust prefs for widget/config storage.</li>
          <li>kotlinx.serialization — Compact NDJSON lines and exports.</li>
          <li>DocumentFile/SAF + FileProvider — User-controlled storage and safe sharing.</li>
          <li>ColorPicker (skydoves) — Intuitive widget color customization.</li>
        </ul>

        <h3>Features</h3>
        <ul>
          <li>Typed trackers: Quantity, Event, Note, Counter (delta+reset), and Choice.</li>
          <li>Quick Entry sheet adapts to type (numeric fields, notes, or dropdown choices).</li>
          <li>Tags on entries; defaults persist via “last used” policy.</li>
          <li>Counter state recomputes safely on edits or resets; prevents future-time drift.</li>
          <li>Widgets: one-tap capture; counters have +/- split zones and a reset icon.</li>
          <li>Mirroring: append every log to <code>entries_log.ndjson</code>; on-demand snapshot to <code>entries_full.ndjson</code>.</li>
          <li>Reminders: daily, weekly (bitmask by weekday), or monthly; optional “skip if already logged”.</li>
          <li>Export: single JSON with trackers + tagged entries for backups or analysis.</li>
        </ul>

        <h3>Challenges</h3>
        <ul>
          <li>Counter accuracy — Updates clamp future timestamps and recompute totals to avoid “future reset” anomalies.</li>
          <li>Widget refresh — Immediate, instance-specific updates via Glance state + AppWidgetManager invalidation.</li>
          <li>SAF reliability — Append writes with linear backoff, plus full snapshot for recovery.</li>
          <li>Reminder logic — Daily/weekly/monthly scheduling with local TZ, channelized silent notifications, and skip-if-logged.</li>
        </ul>

        <h2>Outcomes</h2>
        <p>
          Logging is fast and low-friction—especially from the homescreen. Typed
          trackers produce clean, analyzable data without sacrificing flexibility.
          All actions work offline; background jobs sync to portable files when possible.
          The result is a dependable, developer-friendly ledger you can extend or
          mine with your own tooling.
        </p>

        <section class="updates">
          <h2>Updates</h2>
          {% assign updates_base = page.url | append: 'updates/' %}
          {% assign updates = site.pages | where_exp: 'u', "u.url contains updates_base" | sort: 'date' | reverse %}
          {% if updates.size > 0 %}
            {% for u in updates limit: 5 %}
              <article class="update">
                <h3><a href="{{ u.url }}">{{ u.title }}</a></h3>
                {% if u.date %}<time datetime="{{ u.date | date_to_xmlschema }}">{{ u.date | date: '%b %d, %Y' }}</time>{% endif %}
                {% if u.excerpt %}<p>{{ u.excerpt }}</p>{% endif %}
              </article>
            {% endfor %}
          {% else %}
            <p>No updates yet.</p>
          {% endif %}
        </section>
      </section>

      <aside class="project-aside">
        <dl class="facts">
          <dt>Status</dt>
          <dd><span class="badge status {{ page.status | downcase }}">{{ page.status }}</span></dd>
          <dt>Tags</dt>
          <dd>{{ page.tags | join: ', ' }}</dd>
          <dt>Started</dt>
          <dd>{{ page.date | date: '%b %Y' }}</dd>
          <dt>Links</dt>
          <dd>
            <ul>
              <li><a href="#">Live demo</a></li>
              <li><a href="#">GitHub</a></li>
            </ul>
          </dd>
        </dl>
      </aside>
    </main>
    <footer class="site-footer">
      <div class="container">
        <small>© {{ "now" | date: "%Y" }} Adam Bandel</small>
      </div>
    </footer>
  </body>
  </html>

