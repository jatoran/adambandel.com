---
title: Tokyo Metro + Places Explorer
summary: Interactive Folium map of Tokyo’s metro and rail network with curated places-of-interest, nearest stations, images, and a mobile-friendly UI.
tags: [Python, Folium, GeoPandas, OSMnx, Geocoding, Mapping]
status: Active
date: 2025-09-29
cover_image: /project-corpus/placeholder.svg
alt: Screenshot of an interactive Tokyo metro and places map
permalink: /project-corpus/projects/tokyo-map/
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title }} — Project</title>
    <meta name="description" content="{{ page.summary }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/project-corpus/assets-styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="/project-corpus/" style="text-decoration:none;color:var(--muted)">← Back to all projects</a>
        <h1 class="project-title">{{ page.title }}</h1>
        <p class="project-subtitle">{{ page.summary }}</p>
      </div>
    </header>
    <main class="container project-main">
      <section class="project-content">
        <div class="hero">
          <img src="{{ page.cover_image }}" alt="{{ page.alt }}" />
        </div>

        <h2>Problem</h2>
        <p>
          Planning days across Tokyo often means juggling a vast rail network, many overlapping operators, and scattered
          information about places to visit. I wanted a simple, phone-friendly map that showed my curated places-of-interest
          alongside the metro and rail lines, automatically highlighted the nearest stations, and let me quickly measure distances
          or orient by GPS while on the go.
        </p>

        <h2>Approach</h2>
        <p>
          I built a data pipeline that pulls metro stations and rail lines from OpenStreetMap via OSMnx, translates and normalizes
          line names, geocodes my address list with caching, and uses a KDTree to compute each place’s nearest stations. The UI is
          rendered with Folium, including tile layers, line overlays, image‑rich popups, an address sidebar, geolocation, and a
          distance measurement tool. Everything saves to a single HTML file for easy sharing or offline viewing.
        </p>

        <h3>Architecture</h3>
        <ul>
          <li>Data ingestion: OSMnx fetches Tokyo boundary, wards, subway stations, and rail lines; outputs cached CSV/GeoJSON.</li>
          <li>Normalization: Line names mapped to English via a JSON dictionary to reduce “Unnamed/Unknown” variance.</li>
          <li>Geocoding: Nominatim with a rate‑limited client and a CSV cache for repeatable runs.</li>
          <li>Nearest stations: SciPy KDTree + geodesic distance to compute top 3 metro stations per place.</li>
          <li>Media: Optional station photos and downloaded place images mapped by name/filename heuristics.</li>
          <li>Visualization: Folium map with multiple tile layers, FeatureGroups per line, sidebars, popups, and mobile CSS.</li>
        </ul>

        <h3>Stack</h3>
        <ul>
          <li>OSMnx + GeoPandas — OSM data retrieval and geospatial processing</li>
          <li>Folium + Branca + Jinja2 — Interactive map rendering to a single HTML file</li>
          <li>Pandas + SciPy — Tabular transforms and KDTree nearest‑neighbor search</li>
          <li>Geopy — Nominatim geocoding with RateLimiter and on‑disk caching</li>
        </ul>

        <h3>Challenges</h3>
        <ul>
          <li>OSM variability — Some lines lacked stable names. I added a mapping layer and filters to avoid “Unnamed” artifacts.</li>
          <li>Geocoding rate limits — Solved with a local cache and polite throttling to make runs repeatable and fast.</li>
          <li>Mobile usability — Sidebars, controls, and popups tuned with responsive CSS and simple toggles.</li>
          <li>Media matching — Filename patterns normalized to associate downloaded images with their corresponding places.</li>
        </ul>

        <h2>Outcomes</h2>
        <p>
          The final artifact is a single, shareable HTML map that combines rail overlays, hundreds of metro stations, and a curated
          set of places with photos, descriptions, and nearest‑station suggestions. It runs entirely client‑side, supports GPS
          locate, and includes distance measuring — handy when planning days in Tokyo.
        </p>

        <h3>Key features</h3>
        <ul>
          <li>Multiple tile styles and per‑line FeatureGroups with color coding.</li>
          <li>Popups show place images, short descriptions, and nearest three stations with distances.</li>
          <li>Sidebar list of places; touch‑friendly on mobile; click to open the corresponding popup.</li>
          <li>Geolocation control and a simple distance measurement tool.</li>
          <li>Optional overlays: wards and custom “areas” polygons.</li>
        </ul>

        <h3>How it works (modules)</h3>
        <ul>
          <li><code>data_fetching.py</code> — OSMnx fetch + ward boundaries + CSV/GeoJSON caches + geocoding.</li>
          <li><code>translation.py</code> — JSON dictionary that maps line/operator names to English.</li>
          <li><code>image_processing.py</code> — Heuristics to map station and place photos to records.</li>
          <li><code>map_utils.py</code> — Folium UI, tile layers, overlays, sidebars, popups, and custom JS/CSS.</li>
          <li><code>main.py</code> — End‑to‑end flow orchestrating fetch → normalize → geocode → nearest → render.</li>
        </ul>

        <h3>Usage</h3>
        <p>Edit <code>main.py</code> to adjust the address list, then run the script to produce an updated <code>tokyo_metro_map.html</code> at the repo root.</p>
        <pre><code># Python 3.12 recommended
pip install -r requirements  # or use pyproject with your tool of choice
python main.py               # generates tokyo_metro_map.html

# Optional: add station images under ./station_images and place photos under ./downloaded_images
</code></pre>

        <section class="updates">
          <h2>Updates</h2>
          {% assign updates_base = page.url | append: 'updates/' %}
          {% assign updates = site.pages | where_exp: 'u', "u.url contains updates_base" | sort: 'date' | reverse %}
          {% if updates.size > 0 %}
            {% for u in updates limit: 5 %}
              <article class="update">
                <h3><a href="{{ u.url }}">{{ u.title }}</a></h3>
                {% if u.date %}<time datetime="{{ u.date | date_to_xmlschema }}">{{ u.date | date: '%b %d, %Y' }}</time>{% endif %}
                {% if u.excerpt %}<p>{{ u.excerpt }}</p>{% endif %}
              </article>
            {% endfor %}
          {% else %}
            <p>No updates yet.</p>
          {% endif %}
        </section>
      </section>

      <aside class="project-aside">
        <dl class="facts">
          <dt>Status</dt>
          <dd><span class="badge status {{ page.status | downcase }}">{{ page.status }}</span></dd>
          <dt>Tags</dt>
          <dd>{{ page.tags | join: ', ' }}</dd>
          <dt>Started</dt>
          <dd>{{ page.date | date: '%b %Y' }}</dd>
          <dt>Links</dt>
          <dd>
            <ul>
              <li><a href="/tokyo_metro_map.html">Live demo (local HTML)</a></li>
              <li><a href="#">GitHub — TBD</a></li>
            </ul>
          </dd>
        </dl>
      </aside>
    </main>
    <footer class="site-footer">
      <div class="container">
        <small>© {{ "now" | date: "%Y" }} Adam Bandel</small>
      </div>
    </footer>
  </body>
  </html>

